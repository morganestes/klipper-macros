[gcode_macro level_bed]
gcode:
    {% set PROFILE_NAME = params.PROFILE_NAME|default('meshy')|string %}

    SAVE_GCODE_STATE NAME={PROFILE_NAME}_mesh

    HOME

    BED_MESH_CLEAR
    BED_MESH_CALIBRATE PROFILE={PROFILE_NAME} METHOD=automatic
    BED_MESH_PROFILE SAVE={PROFILE_NAME}
    BED_MESH_PROFILE LOAD={PROFILE_NAME}

    RESTORE_GCODE_STATE NAME={PROFILE_NAME}_mesh
